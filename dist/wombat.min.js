var Wombat = (function () {
  "use strict";
  let t = (t) => t.offsetWidth > 0 && t.offsetHeight > 0,
    e = {
      excludes: [],
      selector: "#wombat",
      displayOnLoad: "",
      overlay: !0,
      overlayClass: "wombat-overlay",
      drawerClass: "wombat-aside",
      afterLoad: function () {},
    };
  function i(t) {
    var i;
    if (!new.target)
      throw "Wombat() doit \xeatre utilis\xe9 comme constructeur et d\xe9clar\xe9 avec le mot-clef new.";
    ((this.dependencies = { switcheroo: "undefined" != typeof Switcheroo }),
      (this.options = Object.assign({}, e, t)),
      (this.transitionEnd = (i = document.createElement("div")).style
        .WebkitTransition
        ? "webkitTransitionEnd"
        : i.style.OTransition
          ? "oTransitionEnd"
          : "transitionend"),
      this.onClick());
  }
  return (
    (i.prototype.build = function () {
      var t;
      ((t = document.createDocumentFragment()),
        (this.aside = document.createElement("aside")),
        (this.aside.className = this.options.drawerClass),
        this.aside.appendChild(this.content),
        t.appendChild(this.aside),
        this.options.overlay &&
          ((this.overlay = document.createElement("div")),
          (this.overlay.className = this.options.overlayClass),
          t.appendChild(this.overlay)),
        document.body.appendChild(t),
        "function" == typeof this.options.afterLoad &&
          this.options.afterLoad(this.aside, this.overlay),
        window.getComputedStyle(this.aside).height,
        this.aside.classList.add("open"),
        this.overlay.classList.add("open"));
    }),
    (i.prototype.binds = function () {
      this.overlay &&
        this.overlay.addEventListener("click", this.close.bind(this));
    }),
    (i.prototype.onClick = function () {
      if (this._delegatedClickHandler) return;
      let t = Array.isArray(this.options.excludes) ? this.options.excludes : [],
        e = (t) => {
          if ("function" == typeof t.composedPath) {
            for (let e of t.composedPath())
              if (e && "A" === e.tagName) return e;
          }
          return t.target && t.target.closest
            ? t.target.closest("a[href]")
            : null;
        },
        i = (t) => {
          let e = (t.pathname || "").match(/^\/u\/?(\d+)/);
          if (e) return e[1];
          let i = t.searchParams && t.searchParams.get("u");
          return i && /^\d+$/.test(i) ? i : null;
        };
      ((this._delegatedClickHandler = (s) => {
        if (
          s.defaultPrevented ||
          0 !== s.button ||
          s.metaKey ||
          s.ctrlKey ||
          s.shiftKey ||
          s.altKey
        )
          return;
        let o = e(s);
        if (
          !o ||
          (t.length &&
            t.some((t) => {
              try {
                return o.matches(t);
              } catch {
                return !1;
              }
            }))
        )
          return;
        let n = o.getAttribute("href");
        if (!n || "#" === n[0] || /^(mailto:|tel:|javascript:)/i.test(n))
          return;
        let a;
        try {
          a = new URL(n, window.location.href);
        } catch {
          return;
        }
        if (
          a.origin !== window.location.origin ||
          !a.pathname ||
          !a.pathname.startsWith("/u")
        )
          return;
        let r = i(a);
        r &&
          (s.preventDefault(),
          s.stopPropagation(),
          this.load(r).then(() => this.open()));
      }),
        document.addEventListener("click", this._delegatedClickHandler, !0));
    }),
    (i.prototype.destroy = function () {
      this._delegatedClickHandler &&
        (document.removeEventListener("click", this._delegatedClickHandler, !0),
        (this._delegatedClickHandler = null));
    }),
    (i.prototype.load = function (e) {
      var i, s;
      return ((i = "/u" + e),
      (s = this.options.selector),
      fetch(i)
        .then((t) => t.text())
        .then((t) => {
          var e = new DOMParser().parseFromString(t, "text/html"),
            o = e.querySelector(s);
          if ((console.log(i, s, e), null === o)) throw Error(void 0);
          return o;
        })
        .catch((t) => {
          console.error(t);
        })).then((e) => {
        this.options.displayOnLoad &&
          !t(e) &&
          (e.style.display = this.options.displayOnLoad);
        var i = document.createDocumentFragment();
        (i.appendChild(e), (this.content = i));
      });
    }),
    (i.prototype.close = function () {
      (this.aside.classList.remove("open"),
        this.overlay.classList.remove("open"),
        this.clear(this.aside, this.overlay));
    }),
    (i.prototype.clear = function (...t) {
      t.forEach((t) => {
        t.addEventListener(this.transitionEnd, function () {
          t.parentNode && t.parentNode.removeChild(t);
        });
      });
    }),
    (i.prototype.open = function () {
      (this.build(), this.binds());
    }),
    i
  );
})();
